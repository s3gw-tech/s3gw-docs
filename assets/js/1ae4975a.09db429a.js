"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8880],{8073:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=s(4848),r=s(8453);const i={},l="Installing K3s for s3gw",o={id:"s3gw-with-k3s",title:"Installing K3s for s3gw",description:"The following document describes the prerequisite installations to run the",source:"@site/../s3gw/docs/guide/s3gw-with-k3s.md",sourceDirName:".",slug:"/s3gw-with-k3s",permalink:"/s3gw-with-k3s",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Installing s3gw with Helm charts",permalink:"/helm-charts"},next:{title:"s3gw-with-k8s",permalink:"/s3gw-with-k8s"}},a={},c=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Installing ingress controller",id:"installing-ingress-controller",level:2},{value:"Installing k3s",id:"installing-k3s",level:2},{value:"Installing Longhorn",id:"installing-longhorn",level:2},{value:"Access the Longhorn UI",id:"access-the-longhorn-ui",level:3},{value:"Install certificate manager",id:"install-certificate-manager",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"installing-k3s-for-s3gw",children:"Installing K3s for s3gw"}),"\n",(0,t.jsx)(n.p,{children:"The following document describes the prerequisite installations to run the\nS3 Gateway (s3gw), an S3 object storage service, on top of a Kubernetes (K8s)\ndistribution, K3s."}),"\n",(0,t.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,t.jsx)(n.p,{children:"If using openSUSE Tumbleweed, we recommend stopping\nfirewalld to ensure k3s runs with full functionality. To do so, run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"systemctl stop firewalld.service\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For more information on K3s and firewalld, see the\n",(0,t.jsx)(n.a,{href:"https://docs.k3s.io/advanced#red-hat-enterprise-linux--centos",children:"k3s documentation"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You can install the s3gw for test purposes locally, on baremetal hardware,\nor virtually. In each instance, ensure you provide adequate disk space.\nLonghorn requires a minimal available storage percentage on the root disk,\nwhich is 25% by default."}),"\n",(0,t.jsx)(n.h2,{id:"installing-ingress-controller",children:"Installing ingress controller"}),"\n",(0,t.jsxs)(n.p,{children:["If you intend to install s3gw with an ingress resource, ensure your\nenvironment is equipped with a ",(0,t.jsx)(n.a,{href:"https://helm.traefik.io/traefik",children:"Traefik"}),"\ningress controller."]}),"\n",(0,t.jsx)(n.p,{children:"You can use a different ingress controller, but note you will have to\ncreate your own ingress resource."}),"\n",(0,t.jsx)(n.h2,{id:"installing-k3s",children:"Installing k3s"}),"\n",(0,t.jsxs)(n.p,{children:["Before you begin, ensure you install K3s. You can find the installation\ninstructions ",(0,t.jsx)(n.a,{href:"https://k3s.io/",children:"here"})," or, run:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -sfL https://get.k3s.io | sh -\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Ensure you move the ",(0,t.jsx)(n.code,{children:"k3s.yaml"})," file, usually hosted in\n",(0,t.jsx)(n.code,{children:"/etc/rancher/k3s/k3s.yaml"}),", to ",(0,t.jsx)(n.code,{children:"~/.kube/config"})," to access the\ncertificates."]}),"\n",(0,t.jsx)(n.h2,{id:"installing-longhorn",children:"Installing Longhorn"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Important:"})," As part of the Longhorn installation, it is required that\n",(0,t.jsx)(n.code,{children:"open-iscsi"})," is installed ",(0,t.jsx)(n.em,{children:"before"})," running the Longhorn installation script.\nEnsure this is done so before continuing."]}),"\n",(0,t.jsxs)(n.p,{children:["You can install Longhorn either via the ",(0,t.jsx)(n.code,{children:"Rancher Apps and Marketplace"}),",\nusing ",(0,t.jsx)(n.code,{children:"kubectl"}),", or via a ",(0,t.jsx)(n.code,{children:"helm chart"}),". The instructions can be found\n",(0,t.jsx)(n.a,{href:"https://longhorn.io/docs/1.4.2/deploy/install/",children:"here"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"To check the progress of the Longhorn installation, run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -w -n longhorn-system\n"})}),"\n",(0,t.jsx)(n.h3,{id:"access-the-longhorn-ui",children:"Access the Longhorn UI"}),"\n",(0,t.jsxs)(n.p,{children:["Now that you have installed Longhorn, access the localhost UI:\n",(0,t.jsx)(n.code,{children:"http://longhorn.<LOCAL-ADDRESS>"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You should now be able to see Longhorn running and there should be no volumes\npresent."}),"\n",(0,t.jsx)(n.h2,{id:"install-certificate-manager",children:"Install certificate manager"}),"\n",(0,t.jsxs)(n.p,{children:["s3gw uses a ",(0,t.jsx)(n.a,{href:"https://cert-manager.io/",children:"cert-manager"})," in order to create TLS\ncertificates for the various ingresses and internal ClusterIP resources."]}),"\n",(0,t.jsxs)(n.p,{children:["Install ",(0,t.jsx)(n.code,{children:"cert-manager"})," as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl create namespace cert-manager\nhelm repo add jetstack https://charts.jetstack.io\nhelm repo update\nhelm install cert-manager --namespace cert-manager jetstack/cert-manager \\\n    --set installCRDs=true \\\n    --set extraArgs[0]=--enable-certificate-owner-ref=true\n"})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);