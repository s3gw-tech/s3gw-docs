"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5621],{1348:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var t=n(4848),r=n(8453);const i={},l="High Availability with s3gw + Longhorn",a={id:"ha/RATIONALE",title:"High Availability with s3gw + Longhorn",description:"- High Availability with s3gw + Longhorn",source:"@site/../s3gw/docs/research/ha/RATIONALE.md",sourceDirName:"ha",slug:"/ha/RATIONALE",permalink:"/research/ha/RATIONALE",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"research",previous:{title:"readme",permalink:"/research/ha/"},next:{title:"Notes",permalink:"/research/ha/measurements/regular_localhost_zeroload_400_800Kdb/"}},o={},d=[{value:"Active/Active",id:"activeactive",level:2},{value:"Active/Warm Standby",id:"activewarm-standby",level:2},{value:"Active/Standby",id:"activestandby",level:2},{value:"Investigation&#39;s Rationale",id:"investigations-rationale",level:2},{value:"Failure cases",id:"failure-cases",level:2},{value:"radosgw&#39;s POD failure and radosgw&#39;s POD rescheduling",id:"radosgws-pod-failure-and-radosgws-pod-rescheduling",level:3},{value:"Non-graceful node failure",id:"non-graceful-node-failure",level:3},{value:"radosgw&#39;s failure due to a bug",id:"radosgws-failure-due-to-a-bug",level:3},{value:"Bug not related to a certain input pattern",id:"bug-not-related-to-a-certain-input-pattern",level:4},{value:"Bug related to a certain input pattern",id:"bug-related-to-a-certain-input-pattern",level:4},{value:"PV Data corruption at application level due to radosgw&#39;s anomalous exit",id:"pv-data-corruption-at-application-level-due-to-radosgws-anomalous-exit",level:3},{value:"Measuring s3gw failures on Kubernetes",id:"measuring-s3gw-failures-on-kubernetes",level:2},{value:"Notes on testing s3gw within K8s",id:"notes-on-testing-s3gw-within-k8s",level:2},{value:"Tested Scenarios - radosgw-restart",id:"tested-scenarios---radosgw-restart",level:2},{value:"regular_localhost_zeroload_emptydb",id:"regular_localhost_zeroload_emptydb",level:3},{value:"segfault_localhost_zeroload_emptydb",id:"segfault_localhost_zeroload_emptydb",level:3},{value:"regular_localhost_load_fio_64_write",id:"regular_localhost_load_fio_64_write",level:3},{value:"regular_localhost_zeroload_400_800Kdb",id:"regular_localhost_zeroload_400_800kdb",level:3},{value:"400K objects - measures done with the WAL file zeroed",id:"400k-objects---measures-done-with-the-wal-file-zeroed",level:4},{value:"800K objects - measures done with the WAL file still to be processed (size 32G)",id:"800k-objects---measures-done-with-the-wal-file-still-to-be-processed-size-32g",level:4},{value:"regular-localhost-incremental-fill-5k",id:"regular-localhost-incremental-fill-5k",level:3},{value:"scale_deployment_0_1-k3s3nodes_zeroload_emptydb",id:"scale_deployment_0_1-k3s3nodes_zeroload_emptydb",level:3},{value:"Tested Scenarios - S3-workload during s3gw Pod outage",id:"tested-scenarios---s3-workload-during-s3gw-pod-outage",level:2},{value:"PutObj-100ms-ClusterIp",id:"putobj-100ms-clusterip",level:3},{value:"PutObj-100ms-Ingress",id:"putobj-100ms-ingress",level:3}];function c(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"high-availability-with-s3gw--longhorn",children:"High Availability with s3gw + Longhorn"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["High Availability with s3gw + Longhorn","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#activeactive",children:"Active/Active"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#activewarm-standby",children:"Active/Warm Standby"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#activestandby",children:"Active/Standby"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#investigations-rationale",children:"Investigation's Rationale"})}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#failure-cases",children:"Failure cases"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#radosgws-pod-failure-and-radosgws-pod-rescheduling",children:"radosgw's POD failure and radosgw's POD rescheduling"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#non-graceful-node-failure",children:"Non-graceful node failure"})}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#radosgws-failure-due-to-a-bug",children:"radosgw's failure due to a bug"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#bug-not-related-to-a-certain-input-pattern",children:"Bug not related to a certain input pattern"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#bug-related-to-a-certain-input-pattern",children:"Bug related to a certain input pattern"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#pv-data-corruption-at-application-level-due-to-radosgws-anomalous-exit",children:"PV Data corruption at application level due to radosgw's anomalous exit"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#measuring-s3gw-failures-on-kubernetes",children:"Measuring s3gw failures on Kubernetes"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#notes-on-testing-s3gw-within-k8s",children:"Notes on testing s3gw within K8s"})}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#tested-scenarios---radosgw-restart",children:"Tested Scenarios - radosgw-restart"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#regular_localhost_zeroload_emptydb",children:"regular_localhost_zeroload_emptydb"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#segfault_localhost_zeroload_emptydb",children:"segfault_localhost_zeroload_emptydb"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#regular_localhost_load_fio_64_write",children:"regular_localhost_load_fio_64_write"})}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#regular_localhost_zeroload_400_800kdb",children:"regular_localhost_zeroload_400_800Kdb"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#400k-objects---measures-done-with-the-wal-file-zeroed",children:"400K objects - measures done with the WAL file zeroed"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#800k-objects---measures-done-with-the-wal-file-still-to-be-processed-size-32g",children:"800K objects - measures done with the WAL file still to be processed (size 32G)"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#regular-localhost-incremental-fill-5k",children:"regular-localhost-incremental-fill-5k"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#scale_deployment_0_1-k3s3nodes_zeroload_emptydb",children:"scale_deployment_0_1-k3s3nodes_zeroload_emptydb"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"#tested-scenarios---s3-workload-during-s3gw-pod-outage",children:"Tested Scenarios - S3-workload during s3gw Pod outage"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#putobj-100ms-clusterip",children:"PutObj-100ms-ClusterIp"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"#putobj-100ms-ingress",children:"PutObj-100ms-Ingress"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["We want to investigate what ",(0,t.jsx)(s.em,{children:"High Availability"})," - HA - means for the s3gw when\nused with Longhorn."]}),"\n",(0,t.jsx)(s.p,{children:"If we identify the meaning of HA as the ability to have N independent pipelines\nso that the failure of some of those does not affect the user's operations,\nthis is something that could be not easy to achieve with the s3gw."}),"\n",(0,t.jsxs)(s.p,{children:["HA, anyway, is not necessarily tied to multiple independent pipelines.\nWhile High Availability (as a component of dependable computing) can be achieved\nthrough redundancy, it can also be achieved by significantly increased reliability\nand quality of the stack. e.g., improving the start time improves HA by lowering\nthe ",(0,t.jsx)(s.em,{children:"Recovery Time Objective"})," (RTO) metric after detecting and recovering from a\nfault.\nFurthermore, we must say: achieving HA in a way that never affects the\nuser's operations is also not realistic, since not all faults can be masked,\nor the complexity required to attempt it would actually be detrimental to\noverall system reliability/availability (aka not cost-effective).\nParadoxically, failing fast instead of hanging on an attempted fault recovery\ncan also increase observed availability."]}),"\n",(0,t.jsx)(s.p,{children:"Our key goal, for the s3gw, is to maximize user-visible, reliable service\navailability, and to be tolerant with regard to certain faults (such as pod crashes,\nsingle node outages ... - the faults we consider or explicitly exclude are discussed\nlater in the document)."}),"\n",(0,t.jsxs)(s.p,{children:["With pipeline, we mean all the chain from the ingress to the persistent volume ",(0,t.jsx)(s.code,{children:"PV"}),"\n(provided by Longhorn):"]}),"\n",(0,t.jsx)(s.mermaid,{value:"flowchart LR\n    ingress(ingress) ==> radosgw(radosgw) ==> PV((PV))"}),"\n",(0,t.jsxs)(s.p,{children:["HA can be difficult with a project like the s3gw because of one process: the ",(0,t.jsx)(s.code,{children:"radosgw"}),",\nowning an ",(0,t.jsx)(s.em,{children:"exclusive"})," access to a resource: the Kubernetes ",(0,t.jsx)(s.code,{children:"PV"})," where the S3\nbuckets and objects are persisted.\nActually, this is also an advantage, due to its lower complexity.\nActive/active syncing of all operations is non-trivial,\nand an active/standby pattern is much simpler to implement with lower overhead\nin the absence of faults."]}),"\n",(0,t.jsx)(s.p,{children:"In theory, 3 HA models are possible with the s3gw:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.strong,{children:"Active/Active"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.strong,{children:"Active/Warm Standby"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.strong,{children:"Active/Standby"})}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"activeactive",children:"Active/Active"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.em,{children:"Active-Active"})," model must implement ",(0,t.jsx)(s.em,{children:"true independent pipelines"}),"\nwhere all the pieces are replicated."]}),"\n",(0,t.jsxs)(s.p,{children:["The immediate consequence of this statement is that every pipeline being part of\nthe same logical s3gw service must bind to a different ",(0,t.jsx)(s.code,{children:"PV"}),"; one per ",(0,t.jsx)(s.code,{children:"radosgw"})," process.\nAll the ",(0,t.jsx)(s.code,{children:"PV"}),"s for the same logical s3gw, must therefore, sync their data."]}),"\n",(0,t.jsx)(s.p,{children:"The need to synchronize and coordinate all operations across all nodes\n(to guarantee Atomicity/Independence/Durability, which even S3's eventual consistency\nmodel needs in some cases) is not free - even then there's a need to ensure the\ndata has been replicated in reality, and since a fault can only be detected via\na timeout of some form, there's still a blip in availability\n(just, hopefully, not a returned error message)."}),"\n",(0,t.jsx)(s.p,{children:"Since the synchronization mechanism is often complex, there's an on-going price\nto be paid for achieving this, plus it is harder to get right\n(lowering availability through lowered quality)."}),"\n",(0,t.jsx)(s.mermaid,{value:"flowchart LR\n    client(client) ==> ingress\n    ingress(ingress) ==> radosgw(radosgw) ==> PV((PV))\n    ingress ==> radosgw2(radosgw) ==> PV2((PV))\n\n    linkStyle 0 stroke: red\n    linkStyle 1 stroke: red\n    linkStyle 2 stroke: red"}),"\n",(0,t.jsx)(s.p,{children:"The ingress might still mask it and automatically retry.\nThat's another thing to consider: most S3 protocol libraries are built\non the assumption of an unreliable network, and so a single non-repeatable\nfailure might not show to the user, but just be (silently or not) retried and\non it goes without anyone knowing beyond a blip in high latency, unless it happens\ntoo often.\nThis is a property of the S3 protocol that makes it a bit easier for us\nto achieve, we hope."}),"\n",(0,t.jsx)(s.mermaid,{value:"flowchart LR\n    client(client) ==> ingress\n    ingress(ingress) ==> radosgw(radosgw) ==> PV((PV))\n    ingress ==> radosgw2(radosgw) ==> PV2((PV))\n\n    linkStyle 0 stroke: green\n    linkStyle 1 stroke: red\n    linkStyle 2 stroke: red\n    linkStyle 3 stroke: green\n    linkStyle 4 stroke: green"}),"\n",(0,t.jsx)(s.h2,{id:"activewarm-standby",children:"Active/Warm Standby"}),"\n",(0,t.jsxs)(s.p,{children:['This model assumes N pipelines to be "allocated" on the cluster at the same time,\nbut only one, the ',(0,t.jsx)(s.em,{children:"active"})," pipeline, owns the ",(0,t.jsx)(s.em,{children:"exclusive ownership"}),"\nover the shared ",(0,t.jsx)(s.code,{children:"PV"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["Should the active pipeline suffer a failure, the next elected active pipeline,\nchosen to replace the old one, should pay a ",(0,t.jsx)(s.em,{children:"time window"}),' necessary to "transfer"\nthe ownership over the shared ',(0,t.jsx)(s.code,{children:"PV"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"The Active plus Warm Standby operation here has no meaningful advantages over the\nActive/Standby option; loading the s3gw pod is the cheapest part of the whole\nprocess, compared to fault detection (usually a timeout), mounting\n(journal recovery) of the file system, the process running the SQLite,\nrecovery on start, etc."}),"\n",(0,t.jsx)(s.p,{children:"We'd pay for this with complexity (and resource consumption while in standby)\nhat likely would only give us very marginal benefits at best."}),"\n",(0,t.jsx)(s.mermaid,{value:"flowchart LR\n    client(client) ==> ingress\n    ingress(ingress) ==> radosgw(radosgw) ==> PV((PV))\n    ingress ==> radosgw2(radosgw)\n\n    linkStyle 0 stroke: red\n    linkStyle 1 stroke: red\n    linkStyle 2 stroke: red"}),"\n",(0,t.jsx)(s.mermaid,{value:"flowchart LR\n    client(client) ==> ingress\n    ingress(ingress) ==> radosgw(radosgw)\n    ingress ==> radosgw2(radosgw) == ownership transfer ==> PV((PV))\n\n    linkStyle 0 stroke: red\n    linkStyle 1 stroke: white\n    linkStyle 2 stroke: red"}),"\n",(0,t.jsx)(s.mermaid,{value:"flowchart LR\n    client(client) ==> ingress\n    ingress(ingress) ==> radosgw(radosgw)\n    ingress ==> radosgw2(radosgw) ==> PV((PV))\n\n    linkStyle 0 stroke: green\n    linkStyle 1 stroke: white\n    linkStyle 2 stroke: green\n    linkStyle 3 stroke: green"}),"\n",(0,t.jsx)(s.h2,{id:"activestandby",children:"Active/Standby"}),"\n",(0,t.jsx)(s.p,{children:"In this scenario, in the event of failure, the system should pay the time\nneeded to fully load a new pipeline."}),"\n",(0,t.jsx)(s.p,{children:"Supposing that the new pipeline has scheduled to load on a node where the\ns3gw image is not cached, the system should pay the time needed to download\nthe image from the registry before starting it."}),"\n",(0,t.jsx)(s.p,{children:"In general on Kubernetes, it can not be assumed that an image is pre-pulled,\nsince nodes may come and go dynamically."}),"\n",(0,t.jsx)(s.p,{children:"Pre-pulled images is something we do want to ensure for eligible nodes.\nOtherwise, our restart is unpredictably long."}),"\n",(0,t.jsx)(s.p,{children:"It's always possible that a fault occurs exactly at the time where we are\npre-loading the image, but that's just bad luck."}),"\n",(0,t.jsx)(s.h2,{id:"investigations-rationale",children:"Investigation's Rationale"}),"\n",(0,t.jsxs)(s.p,{children:["The 3 models described above have different performances and different implementation\nefforts. While the ",(0,t.jsx)(s.em,{children:"Active/Active"}),' model is expected to require a significant\ndevelopment effort due to its inherent complex nature, for our use case,\nthe Active/Standby model built on top of Longhorn actually makes\nthe most sense and brings the "best" HA characteristics relative to implementing\na more fully active/distributed solution.']}),"\n",(0,t.jsxs)(s.p,{children:["In particular, the ",(0,t.jsx)(s.em,{children:"Active/Standby"})," model, is expected to work with nothing\nbut the primitives normally available on any Kubernetes cluster."]}),"\n",(0,t.jsx)(s.p,{children:"Given that the backend s3gw architecture is composed by:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["one ingress and one ",(0,t.jsx)(s.code,{children:"ClusterIP"})," service"]}),"\n",(0,t.jsxs)(s.li,{children:["one ",(0,t.jsx)(s.em,{children:"stateless"})," ",(0,t.jsx)(s.code,{children:"radosgw"})," process associated with a ",(0,t.jsx)(s.em,{children:"stateful"})," ",(0,t.jsx)(s.code,{children:"PV"})]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["it is supposed that, when the ",(0,t.jsx)(s.code,{children:"radosgw"})," process fails, a simple reschedule\nof its POD could be enough to fulfill this HA model.\nAll of this has obviously timeouts and delays, we suspect we'll have to adjust them\nfor our requirements."]}),"\n",(0,t.jsxs)(s.p,{children:["A clarification is needed here: the ",(0,t.jsx)(s.code,{children:"PV"})," ",(0,t.jsx)(s.em,{children:"state"})," is guaranteed by ",(0,t.jsx)(s.strong,{children:"Longhorn"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["Longhorn ensures that a ",(0,t.jsx)(s.code,{children:"PV"})," (along with its content) is always available on\nany cluster's node, so that, a POD can mount it regardless of its allocation on the\ncluster."]}),"\n",(0,t.jsx)(s.p,{children:"Obviously, we can't achieve higher availability or reliability than the underlying\nLonghorn volumes."}),"\n",(0,t.jsx)(s.h2,{id:"failure-cases",children:"Failure cases"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"PV"})," state is kept coherent by Longhorn, so errors at this level are assumed\nNOT possible; application level corruptions to the ",(0,t.jsx)(s.code,{children:"PV"}),"'s state ARE possible.\ns3gw won't corrupt the PV's state or the file system on it,\nbut it might corrupt its own application data.\nAny corruption in the file system is outside what s3gw can reasonably protect\nagainst; at best, it can crash in a way that doesn't corrupt the data further,\nbut that's all undefined behavior and \"restore from backup\" time."]}),"\n",(0,t.jsx)(s.p,{children:"What are the failure cases that can happen for s3gw?\nMaking these cases explicit could be useful for a theoretical reasoning on what\nscenarios we can actually think to solve with an HA model.\nIf a case is clearly outside what an HA model can handle, we must expect that\nthe Kubernetes back off mechanism to be the only mitigation when a restart loop\nshould occur."}),"\n",(0,t.jsx)(s.p,{children:"Let's examine the following scenarios:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"radosgw"}),"'s POD failure and ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s POD rescheduling"]}),"\n",(0,t.jsx)(s.li,{children:"Non-graceful node failure"}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"radosgw"}),"'s failure due to a bug"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"PV"})," PV Data corruption at application level due to radosgw's anomalous exit"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"We are supposing all these bugs or conditions to be fatal for the s3gw's process\nso that they trigger an anomalous exit."}),"\n",(0,t.jsx)(s.h3,{id:"radosgws-pod-failure-and-radosgws-pod-rescheduling",children:"radosgw's POD failure and radosgw's POD rescheduling"}),"\n",(0,t.jsxs)(s.p,{children:["This case occurs when the ",(0,t.jsx)(s.code,{children:"radosgw"})," process stops due to a failure of its POD."]}),"\n",(0,t.jsx)(s.p,{children:'This case applies also when Kubernetes decides to reschedule the POD\nto another node, eg: when the node goes low on resources.\nThis would often be called a "switch-over" in an HA cluster -\ne.g., an administratively orchestrated transition of the service to a new node\n(say, for maintenance/upgrade/etc reasons).\nThis has the advantage of being schedulable, so it can happen at times\nof low load if these exist.\nIn combination with proper interaction with the ingress - pausing requests\nthere instead of failing them - we should be able to mask these cleanly.'}),"\n",(0,t.jsx)(s.p,{children:"Bonus: this is also what we need to seamlessly restart on upgrade/update of the\npod itself transparently."}),"\n",(0,t.jsxs)(s.p,{children:["This can be thought as an infrastructure issue independent to the s3gw.\nIn this case, the ",(0,t.jsx)(s.em,{children:"Active/Standby"})," model fully restores the service by\nrescheduling a new POD somewhere in the cluster."]}),"\n",(0,t.jsx)(s.h3,{id:"non-graceful-node-failure",children:"Non-graceful node failure"}),"\n",(0,t.jsxs)(s.p,{children:["This case occurs when the ",(0,t.jsx)(s.code,{children:"radosgw"})," process stops due to a cluster's node failure.\nThis also means we weren't shut down cleanly.\nSo the recovery needs to be optimized for the stack, and as soon as we\ncan, we need to hook into the ingress and tell it to pause until we're done,\nand then resume."]}),"\n",(0,t.jsxs)(s.p,{children:["Kubernetes detects node failures but a recovery in this situation may take a\nvery long time due to timeouts and grace periods; see Longhorn's documentation:\n",(0,t.jsx)(s.a,{href:"https://longhorn.io/docs/1.5.1/high-availability/node-failure/#what-to-expect-when-a-kubernetes-node-fails",children:"what to expect when a kubernetes node fails"}),'\n( suggests "up to 7 minutes", which is often unacceptable in response to node failures).']}),"\n",(0,t.jsxs)(s.p,{children:["In Kubernetes 1.28, k8s has gained GA support for the concept of ",(0,t.jsx)(s.a,{href:"https://kubernetes.io/blog/2023/08/16/kubernetes-1-28-non-graceful-node-shutdown-ga",children:"non-graceful\nnode shutdowns"})," and orchestrating recovery actions\nonce the taint/flag is manually set.\nCurrently, this relies on manual intervention - the administrator needs to ensure\nthe node(s) is (are) really down to avoid risk of split-brain scenarios."]}),"\n",(0,t.jsxs)(s.p,{children:["Regarding this topic, we have opened a specific issue:\n",(0,t.jsx)(s.a,{href:"https://github.com/longhorn/longhorn/issues/6803",children:"Improving recovery times for non-graceful node failures"}),"\nwithin the Longhorn project."]}),"\n",(0,t.jsx)(s.h3,{id:"radosgws-failure-due-to-a-bug",children:"radosgw's failure due to a bug"}),"\n",(0,t.jsx)(s.h4,{id:"bug-not-related-to-a-certain-input-pattern",children:"Bug not related to a certain input pattern"}),"\n",(0,t.jsx)(s.p,{children:"The crash is caused by a bug not directly related to any input type."}),"\n",(0,t.jsx)(s.p,{children:"Examples:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Memory leaks"}),"\n",(0,t.jsx)(s.li,{children:"Memory corruptions (stack or heap corruptions)"}),"\n",(0,t.jsx)(s.li,{children:"Periodic operations or routines not related to an input (GC, measures,\ntelemetry, etc)"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["For a bug like this, the ",(0,t.jsx)(s.em,{children:"Active/Standby"})," model could guarantee\nthe user's operations ",(0,t.jsx)(s.em,{children:"until the next occurrence"})," of the same malfunctioning."]}),"\n",(0,t.jsx)(s.p,{children:"A definitive solution would be available only when a patch for the issue\nhas released."}),"\n",(0,t.jsx)(s.h4,{id:"bug-related-to-a-certain-input-pattern",children:"Bug related to a certain input pattern"}),"\n",(0,t.jsx)(s.p,{children:"The crash is caused by a bug directly related to a certain input type."}),"\n",(0,t.jsx)(s.p,{children:"Examples:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Putting Buckets with some name's pattern"}),"\n",(0,t.jsx)(s.li,{children:"Putting Objects that have a certain size"}),"\n",(0,t.jsx)(s.li,{children:"Performing an admin operation over a suspended user"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["For a bug like this, the ",(0,t.jsx)(s.em,{children:"Active/Standby"})," model could guarantee\nthe user's operations under the condition that the crash-triggering\ninput is recognized by the user and thus its submission blocked."]}),"\n",(0,t.jsx)(s.h3,{id:"pv-data-corruption-at-application-level-due-to-radosgws-anomalous-exit",children:"PV Data corruption at application level due to radosgw's anomalous exit"}),"\n",(0,t.jsxs)(s.p,{children:["This case occurs when the state on the ",(0,t.jsx)(s.code,{children:"PV"})," corrupts due to a ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s\nanomalous exit."]}),"\n",(0,t.jsxs)(s.p,{children:["In this unfortunate scenario, the ",(0,t.jsx)(s.em,{children:"Active/Standby"})," can hardly help.\nA restart could evenly fix the problem or trigger an endless restarting loop.\nLogical data corruption is a Robustness/Reliability problem; the best we can\naim for is to detect it (and abort with prejudice and finally so, so as to not\nmake the corruption worse).\nThe fix for this could contemplate an human intervention.\nA definitive solution would be available only when a patch for the issue\nis available."]}),"\n",(0,t.jsx)(s.h2,{id:"measuring-s3gw-failures-on-kubernetes",children:"Measuring s3gw failures on Kubernetes"}),"\n",(0,t.jsxs)(s.p,{children:["After reviewing the cases, we can say that what can be actually solved with\nan HA model with s3gw is when the failure is not dependent to applicative bugs.\nWe can handle temporary issues involving the infrastructure that is hosting\nthe ",(0,t.jsx)(s.code,{children:"radosgw"})," process."]}),"\n",(0,t.jsx)(s.p,{children:"We are interested in measuring:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"The (kill - re) start loop timing outside of k8s/LH.\nSo we have a baseline and we can measure of what Kubernetes adds, and how slow\nthe s3gw is when exiting:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Cleanly"}),"\n",(0,t.jsx)(s.li,{children:"Crashing with no ops in flight"}),"\n",(0,t.jsx)(s.li,{children:"Crashing with a load on-going"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Then, fault detection times for k8s - how long until it notices that the\nprocess has crashed (that should be quick due to the generated signal),\nbut what about the process hanging? (e.g., crashes are separate from timeouts)"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Node failures, again, we need to understand which factors affect k8s detecting\nthat and reacting to them, and what latencies are introduced by k8s/LH."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Actively asking k8s to restart is different (see case one, switch- vs fail-over).\nThat should be smooth, but is not actually a failure scenario.\nProbably worth handling in a separate section."}),"\n",(0,t.jsxs)(s.p,{children:["Hence, The idea to collect measures regarding a series of restarts\nartificially triggered on the ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s POD.\nObtaining such measures would allow to compute some arbitrary statistics\nfor the time required by Kubernetes to restart the ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s POD."]}),"\n",(0,t.jsx)(s.h2,{id:"notes-on-testing-s3gw-within-k8s",children:"Notes on testing s3gw within K8s"}),"\n",(0,t.jsxs)(s.p,{children:["As previously said, we want to compute some statistics regarding the Kubernetes\nperformances when restarting the ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s Pod."]}),"\n",(0,t.jsxs)(s.p,{children:["We developed the ",(0,t.jsx)(s.code,{children:"s3gw Probe"}),", a program with the purpose of collecting\ncertain events coming from the ",(0,t.jsx)(s.code,{children:"radosgw"})," process.\nThe tool acts as a client/server service inside the Kubernetes cluster."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["It acts as client vs the ",(0,t.jsx)(s.code,{children:"radosgw"})," process requesting it to die."]}),"\n",(0,t.jsxs)(s.li,{children:["It acts as client vs the k8s's ",(0,t.jsx)(s.code,{children:"control plane"})," requesting a certain deployment\nto scale up and down."]}),"\n",(0,t.jsxs)(s.li,{children:["It acts as server of ",(0,t.jsx)(s.code,{children:"radosgw"})," process collecting its ",(0,t.jsx)(s.code,{children:"death"})," and ",(0,t.jsx)(s.code,{children:"start"})," events."]}),"\n",(0,t.jsxs)(s.li,{children:["It acts as server of the user's client accepting configurations of restart\nscenarios to be triggered against the ",(0,t.jsx)(s.code,{children:"radosgw"})," process."]}),"\n",(0,t.jsx)(s.li,{children:"It acts as server of the user's client returning statistics over the collected\ndata."}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"radosgw"})," code has been patched to accept a REST call from the probe\nwhere the user can specify the way the ",(0,t.jsx)(s.code,{children:"radosgw"})," will exit."]}),"\n",(0,t.jsxs)(s.p,{children:["Currently, 4 modes are possible against the ",(0,t.jsx)(s.code,{children:"radosgw"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"exit0"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"exit1"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"segfault"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"regular"})}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Regardless of the process's exit code, with Deployments, Kubernetes deals\nwith a restart loop using the same strategy.\nA Pod handled by a Deployment goes into the ",(0,t.jsx)(s.code,{children:"CrashLoopBackoff"})," state.\nThe Pod is not managed on its own. It is managed through a ReplicaSet, which in\nturn is managed through a Deployment. A Deployment is a Kubernetes workload\nprimitive whose Pods are assumed to run indefinitely."]}),"\n",(0,t.jsxs)(s.p,{children:["About this behavior, there is actually an opened request to make the\n",(0,t.jsx)(s.a,{href:"https://github.com/kubernetes/kubernetes/issues/57291",children:"CrashLoopBackoff timing tuneable"}),",\nat least for the cases when the process exits with zero."]}),"\n",(0,t.jsxs)(s.p,{children:["Anyway, this behavior led us to think a different way we could use to achieve a\nsufficient number of restarts samples for the ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s Pod.\nWe ended up issuing a ",(0,t.jsx)(s.code,{children:"scale deployment 0"})," followed by a ",(0,t.jsx)(s.code,{children:"scale deployment 1"})," applied\nto the ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s deployment.\nThis trick allows to generate an arbitrary number of Pod restarts without falling\ninto the ",(0,t.jsx)(s.code,{children:"CrashLoopBackoff"})," state."]}),"\n",(0,t.jsxs)(s.p,{children:["So, inside a Kubernetes environment, the probe tool can pilot the ",(0,t.jsx)(s.code,{children:"control plane"}),"\nto scale down and up the s3gw's backend pod."]}),"\n",(0,t.jsxs)(s.p,{children:["Currently, 2 modes are possible against the ",(0,t.jsx)(s.code,{children:"control plane"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"k8s_scale_deployment_0_1"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"k8s_scale_deployment_0_1_node_rr"})}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"tested-scenarios---radosgw-restart",children:"Tested Scenarios - radosgw-restart"}),"\n",(0,t.jsxs)(s.p,{children:["When we test a scenario we are interested in collecting ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s restart\nevents; for each restart we measure the following metrics:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"to_main"}),": this is evaluated as the duration elapsed between a ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s\ndeath event and the measure at the very begin of the ",(0,t.jsx)(s.code,{children:"main"})," body\nin the newly restarted process."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"to_frontend_up"}),": this is evaluated as the duration elapsed between a ",(0,t.jsx)(s.code,{children:"radosgw"}),"'s\ndeath event and the measure just after the newly restarted process is\nable to accept a ",(0,t.jsx)(s.code,{children:"TCP/IP"})," connection from a client."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["From these 2 metrics, we produce also a derived metric: ",(0,t.jsx)(s.code,{children:"frontend_up_main_delta"}),",\nthat is just the arithmetic difference between ",(0,t.jsx)(s.code,{children:"to_frontend_up"})," and ",(0,t.jsx)(s.code,{children:"to_main"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"For each scenario tested we collect a set of measures.\nFor each scenario tested we produce a set of artifacts:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"*_stats.json"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["It is the ",(0,t.jsx)(s.code,{children:"json"})," file containing all the measures done for a scenario.\nIt also contains some key statistics."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"*_raw.svg"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["It is the plot containing the all the charts for the measures:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"to_main"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"to_frontend_up"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"frontend_up_main_delta"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["On the X axis there are the restart event's ",(0,t.jsx)(s.code,{children:"ID"}),"s.\nThey follow the temporal order of the restart events."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"*_percentiles_to_main.svg"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["It is the plot containing the percentile graph for the ",(0,t.jsx)(s.code,{children:"to_main"}),"\nmetric."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"*_percentiles_to_fup.svg"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["It is the plot containing the percentile graph for the ",(0,t.jsx)(s.code,{children:"to_frontend_up"}),"\nmetric."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"*_percentiles_fup_main_delta.svg"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["It is the plot containing the percentile graph for the ",(0,t.jsx)(s.code,{children:"frontend_up_main_delta"}),"\nmetric."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"The file name, normally, contains some information such as:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["deathtype: the way the ",(0,t.jsx)(s.code,{children:"radosgw"})," process is asked to die:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"exit0"})," - the process is asked to immediately exit with ",(0,t.jsx)(s.code,{children:"exit(0)"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"exit1"})," - the process is asked to immediately exit with ",(0,t.jsx)(s.code,{children:"exit(1)"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"segfault"})," - the process is asked to trigger a ",(0,t.jsx)(s.code,{children:"segmentation fault"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"regular"})," - the process is asked to exit with the ordered shutdown procedure"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"environment: the environment where the scenario is tested:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"localhost/host-path-volume"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"k8s/k3d/k3s ... /host-path-volume"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"k8s/k3d/k3s ... /LH-volume"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"description: is a key description of the scenario"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"TS: this is just a timestamp of when the artifacts were produced"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"regular_localhost_zeroload_emptydb",children:"regular_localhost_zeroload_emptydb"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"regular"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"localhost/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["load: ",(0,t.jsx)(s.code,{children:"zero-empty-db"})]}),"\n",(0,t.jsxs)(s.li,{children:["#measures: ",(0,t.jsx)(s.code,{children:"100"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_emptydb/regular-localhost-zeroload-emptydb_raw_1694425886.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_emptydb/regular-localhost-zeroload-emptydb_percentiles_to_main_1694425886.svg"})})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_emptydb/regular-localhost-zeroload-emptydb_percentiles_to_fup_1694425886.svg"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_emptydb/regular-localhost-zeroload-emptydb_percentiles_fup_main_delta_1694425886.svg"})})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"segfault_localhost_zeroload_emptydb",children:"segfault_localhost_zeroload_emptydb"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"segfault"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"localhost/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["load: ",(0,t.jsx)(s.code,{children:"zero-empty-db"})]}),"\n",(0,t.jsxs)(s.li,{children:["#measures: ",(0,t.jsx)(s.code,{children:"100"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/segfault_localhost_zeroload_emptydb/segfault-localhost-zeroload-emptydb_raw_1694428197.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/segfault_localhost_zeroload_emptydb/segfault-localhost-zeroload-emptydb_percentiles_to_main_1694428197.svg"})})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/segfault_localhost_zeroload_emptydb/segfault-localhost-zeroload-emptydb_percentiles_to_fup_1694428197.svg"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/segfault_localhost_zeroload_emptydb/segfault-localhost-zeroload-emptydb_percentiles_fup_main_delta_1694428197.svg"})})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"regular_localhost_load_fio_64_write",children:"regular_localhost_load_fio_64_write"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"regular"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"localhost/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["load: ",(0,t.jsx)(s.code,{children:"fio"})]}),"\n",(0,t.jsxs)(s.li,{children:["#measures: ",(0,t.jsx)(s.code,{children:"100"})]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"fio"})," configuration:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ini",children:"[global]\nioengine=http\nhttp_verbose=0\nhttps=off\nhttp_mode=s3\nhttp_s3_key=test\nhttp_s3_keyid=test\nhttp_host=localhost:7480\n\n[s3-write]\nfilename=/workload-1/obj1\nnumjobs=8\nrw=write\nsize=64m\nbs=1m\n"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_load_fio_64_write/regular-localhost-writeload_raw_1694440297.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_load_fio_64_write/regular-localhost-writeload_percentiles_to_main_1694440297.svg"})})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_load_fio_64_write/regular-localhost-writeload_percentiles_to_fup_1694440297.svg"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_load_fio_64_write/regular-localhost-writeload_percentiles_fup_main_delta_1694440297.svg"})})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"regular_localhost_zeroload_400_800kdb",children:"regular_localhost_zeroload_400_800Kdb"}),"\n",(0,t.jsx)(s.h4,{id:"400k-objects---measures-done-with-the-wal-file-zeroed",children:"400K objects - measures done with the WAL file zeroed"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"regular"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"localhost/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["load: ",(0,t.jsx)(s.code,{children:"zero-400K-db"})]}),"\n",(0,t.jsxs)(s.li,{children:["#measures: ",(0,t.jsx)(s.code,{children:"100"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-400Kdb_raw_1694522179.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-400Kdb_percentiles_to_main_1694522179.svg"})})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-400Kdb_percentiles_to_fup_1694522179.svg"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-400Kdb_percentiles_fup_main_delta_1694522179.svg"})})]})})]}),"\n",(0,t.jsx)(s.h4,{id:"800k-objects---measures-done-with-the-wal-file-still-to-be-processed-size-32g",children:"800K objects - measures done with the WAL file still to be processed (size 32G)"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"regular"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"localhost/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["load: ",(0,t.jsx)(s.code,{children:"zero-800K-db"})]}),"\n",(0,t.jsxs)(s.li,{children:["#measures: ",(0,t.jsx)(s.code,{children:"100"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-800Kdb_raw_1694524508.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-800Kdb_percentiles_to_main_1694524508.svg"})})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-800Kdb_percentiles_to_fup_1694524508.svg"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular_localhost_zeroload_400_800Kdb/regular-localhost-zeroload-800Kdb_percentiles_fup_main_delta_1694524508.svg"})})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"regular-localhost-incremental-fill-5k",children:"regular-localhost-incremental-fill-5k"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"regular"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"localhost/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["load: ",(0,t.jsx)(s.code,{children:"5K-incremental-800K-db"})]}),"\n",(0,t.jsxs)(s.li,{children:["#measures: ",(0,t.jsx)(s.code,{children:"100"})]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Between every restart there is an interposed ",(0,t.jsx)(s.code,{children:"PUT-Object"})," sequence, each of 5K objects;\nthe sqlite db initially contained 800K objects."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular-localhost-incremental-fill-5k/regular-localhost-incremental-fill-5k_raw_1694534032.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/regular-localhost-incremental-fill-5k/regular-localhost-incremental-fill-5k_percentiles_to_main_1694534032.svg"})})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular-localhost-incremental-fill-5k/regular-localhost-incremental-fill-5k_percentiles_to_fup_1694534032.svg"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/regular-localhost-incremental-fill-5k/regular-localhost-incremental-fill-5k_percentiles_fup_main_delta_1694534032.svg"})})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"scale_deployment_0_1-k3s3nodes_zeroload_emptydb",children:"scale_deployment_0_1-k3s3nodes_zeroload_emptydb"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"scale_deployment_0_1"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"virtual-machine/k3s-3-nodes/LH-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["load: ",(0,t.jsx)(s.code,{children:"zero-empty-db"})]}),"\n",(0,t.jsxs)(s.li,{children:["#measures: ",(0,t.jsx)(s.code,{children:"300"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"The test has been conducted in 3 blocks, each of 100 restarts.\nEach restart in a block is constrained to occur on a specific node.\nThe schema is the following:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["taint all nodes but ",(0,t.jsx)(s.code,{children:"node-1"})]}),"\n",(0,t.jsx)(s.li,{children:"trigger 100 pod restarts"}),"\n",(0,t.jsxs)(s.li,{children:["taint all nodes but ",(0,t.jsx)(s.code,{children:"node-2"})]}),"\n",(0,t.jsx)(s.li,{children:"trigger 100 pod restarts"}),"\n",(0,t.jsxs)(s.li,{children:["taint all nodes but ",(0,t.jsx)(s.code,{children:"node-3"})]}),"\n",(0,t.jsx)(s.li,{children:"trigger 100 pod restarts"}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/scale_deployment_0_1-k3s3nodes-zeroload-emptydb/scale_deployment_0_1-k3s3nodes-zeroload-emptydb_raw_1695046129.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/scale_deployment_0_1-k3s3nodes-zeroload-emptydb/scale_deployment_0_1-k3s3nodes-zeroload-emptydb_percentiles_to_main_1695046129.svg"})})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/scale_deployment_0_1-k3s3nodes-zeroload-emptydb/scale_deployment_0_1-k3s3nodes-zeroload-emptydb_percentiles_to_fup_1695046129.svg"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("img",{src:"measurements/scale_deployment_0_1-k3s3nodes-zeroload-emptydb/scale_deployment_0_1-k3s3nodes-zeroload-emptydb_percentiles_fup_main_delta_1695046129.svg"})})]})})]}),"\n",(0,t.jsx)(s.h2,{id:"tested-scenarios---s3-workload-during-s3gw-pod-outage",children:"Tested Scenarios - S3-workload during s3gw Pod outage"}),"\n",(0,t.jsxs)(s.p,{children:["These scenarios are focused in collecting data from an S3 client performing\na workload during an s3gw outage.\nFor each S3 operation we collect both its Round Trip Time - ",(0,t.jsx)(s.code,{children:"RTT"})," - and its\n",(0,t.jsx)(s.code,{children:"result"})," (success/failure).\nThen, we correlate an s3gw's outage with collected results and RTTs."]}),"\n",(0,t.jsx)(s.p,{children:"For each scenario tested we produce a specific artifact:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"*_S3WL_RTT_raw.svg"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["It is the plot containing the ",(0,t.jsx)(s.code,{children:"RTT S3Workload"})," chart:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"X-Axis"}),": Relative time (starting from 0) when an S3 operation occurred."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Y-Axis"}),": The ",(0,t.jsx)(s.code,{children:"RTT"}),"'s duration in milliseconds."]}),"\n",(0,t.jsxs)(s.li,{children:["Each vertical bar is colorized in: ",(0,t.jsx)(s.code,{children:"Green"})," when the corresponding S3 operation\nwas successful, in ",(0,t.jsx)(s.code,{children:"Red"})," when the operation failed."]}),"\n",(0,t.jsxs)(s.li,{children:["On the ",(0,t.jsx)(s.strong,{children:"X-Axis"}),", in ",(0,t.jsx)(s.code,{children:"Yellow"}),", are drawn all the s3gw's outages occurred\nin the test; the segment represents the begin and the end of an outage."]}),"\n",(0,t.jsxs)(s.li,{children:["On the ",(0,t.jsx)(s.strong,{children:"X-Axis"}),", in ",(0,t.jsx)(s.code,{children:"Cyan"}),", are drawn the durations before\nthe first successful S3 operation after an outage."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"putobj-100ms-clusterip",children:"PutObj-100ms-ClusterIp"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"regular"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"k3d/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["client-S3-workload: ",(0,t.jsx)(s.code,{children:"PutObject/100ms"})]}),"\n",(0,t.jsxs)(s.li,{children:["S3-endpoint: ",(0,t.jsx)(s.code,{children:"s3gw-ClusterIP-service"})]}),"\n",(0,t.jsxs)(s.li,{children:["#restarts: ",(0,t.jsx)(s.code,{children:"10"})]}),"\n",(0,t.jsxs)(s.li,{children:["#S3-operations: ",(0,t.jsx)(s.code,{children:"394"})]}),"\n"]}),"\n",(0,t.jsx)(s.table,{children:(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/s3wl-putobj-100ms-clusterip/1695396383_s3wl-putobj-100ms-ClusterIp_S3WL_RTT_raw.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/s3wl-putobj-100ms-clusterip/1695396383_s3wl-putobj-100ms-ClusterIp_raw.svg"})})]})})}),"\n",(0,t.jsx)(s.h3,{id:"putobj-100ms-ingress",children:"PutObj-100ms-Ingress"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["restart-type: ",(0,t.jsx)(s.code,{children:"regular"})]}),"\n",(0,t.jsxs)(s.li,{children:["env: ",(0,t.jsx)(s.code,{children:"k3d/host-path-volume"})]}),"\n",(0,t.jsxs)(s.li,{children:["client-S3-workload: ",(0,t.jsx)(s.code,{children:"PutObject/100ms"})]}),"\n",(0,t.jsxs)(s.li,{children:["S3-endpoint: ",(0,t.jsx)(s.code,{children:"s3gw-Ingress"})]}),"\n",(0,t.jsxs)(s.li,{children:["#restarts: ",(0,t.jsx)(s.code,{children:"10"})]}),"\n",(0,t.jsxs)(s.li,{children:["#S3-operations: ",(0,t.jsx)(s.code,{children:"504"})]}),"\n"]}),"\n",(0,t.jsx)(s.table,{children:(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/s3wl-putobj-100ms-ingress/1695396145_s3wl-putobj-100ms-Ingress_S3WL_RTT_raw.svg"})}),(0,t.jsx)(s.th,{children:(0,t.jsx)("img",{src:"measurements/s3wl-putobj-100ms-ingress/1695396145_s3wl-putobj-100ms-Ingress_raw.svg"})})]})})}),"\n",(0,t.jsx)(s.hr,{})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var t=n(6540);const r={},i=t.createContext(r);function l(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);