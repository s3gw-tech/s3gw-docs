"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3625],{6686:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var s=t(4848),i=t(8453);const o={},a="Advanced usage",r={id:"advanced-usage",title:"Advanced usage",description:"The processes and steps described in this page should not be applicable to the",source:"@site/../s3gw/docs/guide/advanced-usage.md",sourceDirName:".",slug:"/advanced-usage",permalink:"/advanced-usage",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"s3gw-with-k8s",permalink:"/s3gw-with-k8s"},next:{title:"metrics",permalink:"/metrics"}},d={},c=[{value:"Running the container",id:"running-the-container",level:2},{value:"Using vhost style buckets",id:"using-vhost-style-buckets",level:3},{value:"Specifying certificates",id:"specifying-certificates",level:3},{value:"Debugging output",id:"debugging-output",level:3},{value:"Environment variables",id:"environment-variables",level:3},{value:"Additional arguments",id:"additional-arguments",level:3}];function l(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"advanced-usage",children:"Advanced usage"}),"\n",(0,s.jsx)(n.p,{children:"The processes and steps described in this page should not be applicable to the\nvast majority of s3gw deployments. However, depending on circumstance, one might\nneed to perform some of these for testing or debugging."}),"\n",(0,s.jsxs)(n.p,{children:["The following sections rely on ",(0,s.jsx)(n.code,{children:"podman"})," for examples. Using ",(0,s.jsx)(n.code,{children:"docker"})," instead\nshould work in the same way, although option names may need to be adjusted on\noccasion."]}),"\n",(0,s.jsx)(n.h2,{id:"running-the-container",children:"Running the container"}),"\n",(0,s.jsxs)(n.p,{children:["One might need to run the container standalone, in which case it's important to\nunderstand how to properly configure it. Running the container with ",(0,s.jsx)(n.code,{children:"--help"}),"\nwill provide some insight."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"podman run -it quay.io/s3gw/s3gw:latest --help"})}),"\n",(0,s.jsx)(n.p,{children:"Which should result in something like the following, minus eventual changes not\nreflected in this example:"}),"\n",(0,s.jsx)(n.p,{children:"usage: /s3gw/bin/entrypoint.sh [options... -- args]"}),"\n",(0,s.jsx)(n.p,{children:'options:\n--help                Shows this message.\n--id ID               Specifies a custom instance ID (default: s3gw).\n--cert FILE KEY       Specifies SSL certificate. Expects a .crt as first\nargument, and a .key as second argument.\n--dns-name VALUE      For vhost style buckets, VALUE should be the DNS domain\nto be used.\n--debug LEVEL         Runs with debug. Levels available: "high", "medium",\n"low", "none" (default: none).\n--no-telemetry        Disable telemetry.\n--telemetry-url URL   Specifies telemetry URL.\n--with-status         Enables status frontend at port 9090.'}),"\n",(0,s.jsx)(n.p,{children:"args:\nAny option supported by RADOS Gateway. For advanced use only."}),"\n",(0,s.jsx)(n.p,{children:"env variables:\nS3GW_ID           Specifies a custom instance ID.\nS3GW_DNS_NAME     Specifies a DNS domain to be used for vhost style buckets.\nS3GW_DEBUG        Specifies the debug level to be used.\nS3GW_CERT_FILE    Specifies the SSL certificate file.\nS3GW_CERT_KEY     Specifies the SSL certificate key file."}),"\n",(0,s.jsx)(n.p,{children:"Keep in mind that to access the service, one needs to expose the required ports.\nFor s3gw these are port 7480 for non-SSL access, and port 7481 for SSL access.\nThis can be achieved with:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"podman run -it -p 7480:7480 quay.io/s3gw/s3gw:latest"})}),"\n",(0,s.jsx)(n.p,{children:"In the following sections, we will be describing some of the available options."}),"\n",(0,s.jsx)(n.h3,{id:"using-vhost-style-buckets",children:"Using vhost style buckets"}),"\n",(0,s.jsxs)(n.p,{children:["S3 supports two styles of bucket access: path and vhost. The former considers\nthe buckets will be part of the address path, like in ",(0,s.jsx)(n.code,{children:"my.domain.tld/my-bucket/"}),",\nwhereas the latter assumes the bucket will be part of the vhost,\n",(0,s.jsx)(n.code,{children:"my-bucket.my.domain.tld"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"By default, s3gw runs with path style buckets. One can enable vhost style\nbuckets by providing the DNS domain name to be used for the service. For\nexample,"}),"\n",(0,s.jsxs)(n.p,{children:["podman run -it -p 7480:7480 ",(0,s.jsx)(n.br,{}),"\n","quay.io/s3gw/s3gw",":latest"," ",(0,s.jsx)(n.br,{}),"\n","--dns-name my.domain.tld"]}),"\n",(0,s.jsx)(n.h3,{id:"specifying-certificates",children:"Specifying certificates"}),"\n",(0,s.jsx)(n.p,{children:"s3gw supports running with SSL, but will require a certificate to be provided.\nThe location of this certificate must be local to the container namespace, and\nthus should be bind mounted into the container."}),"\n",(0,s.jsxs)(n.p,{children:["podman run -it -p 7481:7481 ",(0,s.jsx)(n.br,{}),"\n","-v ./my-cert.crt:/data/my-cert.crt ",(0,s.jsx)(n.br,{}),"\n","-v ./my-cert.key:/data/my-cert.key ",(0,s.jsx)(n.br,{}),"\n","quay.io/s3gw/s3gw",":latest"," ",(0,s.jsx)(n.br,{}),"\n","--cert /data/my-cert.crt /data/my-cert.key"]}),"\n",(0,s.jsx)(n.p,{children:"The s3gw service should now be available on the host's port 7481 with SSL\nenabled."}),"\n",(0,s.jsx)(n.h3,{id:"debugging-output",children:"Debugging output"}),"\n",(0,s.jsxs)(n.p,{children:["s3gw supports four different log levels: ",(0,s.jsx)(n.code,{children:"none"}),", ",(0,s.jsx)(n.code,{children:"low"}),", ",(0,s.jsx)(n.code,{children:"medium"}),", and ",(0,s.jsx)(n.code,{children:"high"}),". By\ndefault, s3gw runs with ",(0,s.jsx)(n.code,{children:"none"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The vast majority of deployments will only require ",(0,s.jsx)(n.code,{children:"none"})," or ",(0,s.jsx)(n.code,{children:"low"}),", for as long\nas they are behaving nicely. In case of misbehavior, it is reasonable to look\ntowards the logs for indication of what the problem might be. In this case, the\ntypical deployment will rely on ",(0,s.jsx)(n.code,{children:"medium"}),". Only in very exceptional situations\nwill a ",(0,s.jsx)(n.code,{children:"high"})," be useful. Keep in mind that at a ",(0,s.jsx)(n.code,{children:"high"})," debug level, the system\nwill be put under a lot of strain from the amount of outputted messages, and the\nvalue of additional verbosity may not be significant."]}),"\n",(0,s.jsxs)(n.p,{children:["Running with debug only requires specifying the ",(0,s.jsx)(n.code,{children:"--debug LEVEL"})," argument to the\ncontainer, such as"]}),"\n",(0,s.jsxs)(n.p,{children:["podman run -it -p 7480:7480 ",(0,s.jsx)(n.br,{}),"\n","quay.io/s3gw/s3gw",":latest"," ",(0,s.jsx)(n.br,{}),"\n","--debug medium"]}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment variables"}),"\n",(0,s.jsxs)(n.p,{children:["The available environment variables reflect the arguments accepted by the\ncontainer. These can be provided to the container using the ",(0,s.jsx)(n.code,{children:"--env VAR=VALUE"}),"\nargument to ",(0,s.jsx)(n.code,{children:"podman run"}),". For example,"]}),"\n",(0,s.jsxs)(n.p,{children:["podman run -it -p 7480:7480 ",(0,s.jsx)(n.br,{}),"\n","--env S3GW_DEBUG=medium ",(0,s.jsx)(n.br,{}),"\n","quay.io/s3gw/s3gw",":latest"]}),"\n",(0,s.jsx)(n.h3,{id:"additional-arguments",children:"Additional arguments"}),"\n",(0,s.jsxs)(n.p,{children:["The container accepts additional arguments, that will be passed directly to the\nunderlying RADOS Gateway binary. These should be used only if one knows what\nthey are doing. To obtain a small subset of the option supported, running with\n",(0,s.jsx)(n.code,{children:"-- --help"})," will provide some information. Please note that not all the options\nprovided in this help message will be applicable."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);